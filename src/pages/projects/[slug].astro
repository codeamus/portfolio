---
import IconWebSite from "@assets/icons/world.astro";
import Footer from "@components/Footer.astro";
import Navbar from "@components/Navbar.astro";
import Layout from "@layouts/Layout.astro";
import { WHATSAPP_URL } from "@utils/const";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { slug: project.data.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { data } = project;
const { slug } = data;

const {
  title,
  image_desktop,
  image_mobile,
  website,
  metaTitle,
  metaDescription,
} = data;

const { Content } = await render(project);

export const prerender = true;
---

<Layout title={metaTitle} description={metaDescription}>
  <Navbar />

  <main class="px-10 py-12 md:px-20 xl:px-72">
    <!-- CABECERA DEL PROYECTO -->
    <section>
      <a
        href="/#proyectos"
        class="text-xs font-semibold uppercase tracking-wide text-white/60 hover:text-white/90"
      >
        ← Volver a proyectos
      </a>

      <h1
        class="mt-3 text-3xl font-bold text-[#7477FF] md:text-4xl"
        transition:name={`name-${title}`}
      >
        {title}
      </h1>

      <p class="mt-2 max-w-2xl text-base leading-relaxed text-white/80">
        Proyecto real desarrollado para un negocio con necesidades específicas.
        Aquí tienes un resumen del contexto, la solución implementada y el
        resultado que se buscaba conseguir.
      </p>

      <div
        class="mt-6 rounded-2xl bg-gradient-to-br from-[#020617] to-[#0f172a] p-4"
      >
        <picture>
          <source srcset={image_desktop} media="(min-width: 1024px)" />
          <img
            transition:name={`img-${slug}`}
            src={image_mobile}
            alt={`Vista del sitio web ${title}`}
            class="w-full rounded-xl shadow-lg"
            loading="lazy"
          />
        </picture>
      </div>
    </section>

    <!-- CONTENIDO / DESCRIPCIÓN -->
    <section
      class="mt-10 grid gap-10 md:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]"
    >
      <div>
        <h2 class="text-2xl font-bold text-[#7477FF] md:text-3xl">
          Descripción del proyecto
        </h2>
        <div
          class="prose prose-invert mt-4 max-w-none text-base leading-relaxed"
        >
          <Content />
        </div>
      </div>

      <aside class="space-y-6 md:pl-6">
        {
          website && (
            <div class="rounded-xl bg-white/5 p-4 shadow-md">
              <h3 class="text-base font-semibold text-white">
                Ver sitio en línea
              </h3>
              <p class="mt-1 text-xs text-white/80">
                Puedes revisar la versión pública de este proyecto y ver cómo se
                ve en producción.
              </p>
              <a
                href={website}
                target="_blank"
                rel="noopener noreferrer"
                aria-label={`Visitar el sitio web de ${title}`}
                class="mt-3 inline-flex items-center gap-2 rounded-lg bg-[#7477FF] px-4 py-2 text-xs font-semibold text-white transition-all hover:bg-[#8a8dff]"
              >
                <IconWebSite className="size-4" />
                <span>Ver sitio</span>
              </a>
            </div>
          )
        }
      </aside>
    </section>

    <!-- CTA DE NEGOCIO -->
    <section class="mt-12 rounded-2xl bg-[#7477FF]/10 p-6 text-center md:p-8">
      <h3 class="text-lg font-bold text-white md:text-xl">
        ¿Quieres un sitio similar para tu negocio?
      </h3>
      <p class="mt-2 text-base leading-relaxed text-white/75">
        Puedo ayudarte a crear una landing page o sitio enfocado en resultados,
        con el mismo nivel de cuidado y detalle aplicado en este proyecto.
      </p>
      <a
        href={WHATSAPP_URL}
        class="mt-4 inline-block rounded-xl bg-[#7477FF] px-6 py-3 text-base font-semibold uppercase tracking-wide text-white transition-all duration-300 hover:bg-[#8a8dff]"
        target="_blank"
        rel="noopener noreferrer"
      >
        Hablemos de tu proyecto
      </a>
    </section>
  </main>

  <Footer />
</Layout>
